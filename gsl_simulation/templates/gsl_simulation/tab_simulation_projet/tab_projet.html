{% extends "gsl_projet/projet/tab_projet.html" %}
{% load static gsl_filters %}

{% block form_for_simulation_projet %}
    <form method="post"
          id="projet_form"
          action="{% url 'gsl_simulation:patch-projet' simu.id %}"
          data-double-dotation-target="form">
        {% csrf_token %}
    </form>
    <form method="post"
          id="dotation_projet_form"
          action="{% url 'gsl_simulation:patch-dotation-projet' simu.id %}">
        {% csrf_token %}
    </form>
{% endblock form_for_simulation_projet %}

{% block detr_avis_commission %}
    {% if enveloppe.dotation == 'DETR' and projet.can_have_a_commission_detr_avis %}
        {% include "includes/forms/_detr_avis_commission_form.html" %}
    {% endif %}
{% endblock detr_avis_commission %}

{% block status_action %}
    {% include "includes/_status_and_notification_status_card.html" with display_notify_button=True %}
{% endblock status_action %}

{% block projet_detail_form %}
    {% include "includes/forms/_is_qpv_and_is_attached_to_a_crte_form.html" %}
{% endblock projet_detail_form %}

{% block transition_ecologique_content %}
    <p>
        <b>Le projet concourt-il aux enjeux de la transition écologique au sens budget vert :</b>
    </p>
    {% include "includes/forms/_is_budget_vert_form.html" %}
{% endblock transition_ecologique_content %}

{% block dotations_form %}
    {% include "includes/forms/_dotations_form.html" %}
{% endblock dotations_form %}

{% block categories %}
    {% for dotation_projet in dotation_projets %}
        <p>
            <b>Catégories d'opération {{ dotation_projet.dotation }}</b>
        </p>

        {% if dotation_projet.dotation == "DSIL" %}
            <p class="fr-text--sm">
                <b>Catégories choisies</b>
            </p>
            <ul class="fr-text--sm">
                {% for critere in dossier.demande_eligibilite_dsil.all %}
                    <li>
                        {{ critere }}
                    </li>
                {% endfor %}
            </ul>
        {% elif dotation_projet.dotation == "DETR" %}
            <p class="fr-text--sm">
                <b>Catégories choisies</b>
            </p>
            <ul class="fr-text--sm">
                {% for categorie in dotation_projet.detr_categories.all %}
                    <li>
                        {{ categorie.libelle }}
                    </li>
                {% endfor %}
            </ul>
            {% if enveloppe.dotation == 'DETR' %}
                {% include "includes/forms/_detr_categories_form.html" %}
            {% endif %}
        {% endif %}
    {% endfor %}

{% endblock categories %}

{% block montants_form %}
    {% if other_dotation_montants %}
        <h6 class="fr-mb-2w fr-mt-6w">
            {{ dotation_projet.dotation }}
        </h6>
    {% endif %}

    {% include "includes/forms/_montants_form.html" %}

    {% if other_dotation_montants %}
        <h6 class="fr-mb-2w fr-mt-6w">
            {{ other_dotation_montants.dotation }}
        </h6>
        {% include "includes/projet_detail/dotation_montant_info.html" with assiette=other_dotation_montants.assiette montant=other_dotation_montants.montant taux=other_dotation_montants.taux %}
    {% endif %}

{% endblock montants_form %}
