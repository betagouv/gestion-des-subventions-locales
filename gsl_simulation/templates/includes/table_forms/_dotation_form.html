{% load gsl_filters %}
{% if projet.notified_at %}
    {{ projet.dotations|join:" et " }}
{% else %}
    <form id="simulation-projet-dotation-form-{{ simu.id }}"
          action="{% url 'simulation:patch-projet' simu.id %}"
          method="POST"
          data-controller="dotation-dropdown"
          data-dotation-dropdown-target="form"
          data-dotation-dropdown-initial-dotations-value="[{% for dotation in projet.dotations %}&quot;{{ dotation }}&quot;{% if not forloop.last %},{% endif %}{% endfor %}]">
        {% csrf_token %}
        <div class="dotation-dropdown">
            <button type="button"
                    class="fr-select gsl-projet-table__select input-simulation-projet-{{ simu.pk }}"
                    data-dotation-dropdown-target="button"
                    data-action="click->dotation-dropdown#toggle">
                {{ projet.dotations|join:" et " }}
            </button>

            <fieldset class="dotation-select-content"
                      data-dotation-dropdown-target="content"
                      style="display: none">
                {% for dotation in dotations %}
                    <div class="fr-checkbox-group fr-checkbox-group--sm">
                        <input form="simulation-projet-dotation-form-{{ simu.id }}"
                               type="checkbox"
                               name="dotations"
                               value="{{ dotation }}"
                               id="id_dotation_{{ simu.id }}_{{ forloop.counter }}"
                               {% if dotation in projet.dotations %}checked{% endif %}
                               data-dotation-dropdown-target="input"
                               data-action="change->dotation-dropdown#checkboxChange">
                        <label for="id_dotation_{{ simu.id }}_{{ forloop.counter }}"
                               class="fr-label">
                            {{ dotation }}
                        </label>
                    </div>
                {% endfor %}
            </fieldset>
        </div>

        <input type="hidden" name="filter_params" value="{{ filter_params }}">
        <input type="submit" hidden />
    </form>
{% endif %}
